var XYGBoy;!function(t){var e=function(){function t(t,e,i){void 0===i&&(i=0),this.row=t,this.column=e,this.matrix=new Array;for(var n=0;t>n;n++){this.matrix[n]=new Array;for(var o=0;e>o;o++)this.matrix[n][o]=i}}var e=(__define,t),i=e.prototype;return i.setValue=function(t,e,i){void 0===i&&(i=0),this.matrix[t][e]=i},i.getValue=function(t,e){return this.matrix[t][e]},i.getRow=function(){return this.row},i.getColumn=function(){return this.column},t}();t.Matrix=e,egret.registerClass(e,"XYGBoy.Matrix")}(XYGBoy||(XYGBoy={}));var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.boxSize=25,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("gboy",1),RES.loadGroup("preload")},n.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},n.createGameScene=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,i=new XYGBoy.GameScene(t,e);this.addChild(i)},n.initMap=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,i=t/this.boxSize,n=e/this.boxSize;this.map=new XYGBoy.DotMap(n,i,this.boxSize),this.map.width=t,this.map.height=e,this.addChild(this.map)},n.movePoint=function(t){console.log(t);var e=t,i=this.time,n=e-i;return this.map.getCursorColumn()+1<this.map.getColumn()?this.map.setCursorColumn(this.map.getCursorColumn()+1):(this.map.setCursorColumn(0),this.map.getCursorRow()+1<this.map.getRow()?this.map.setCursorRow(this.map.getCursorRow()+1):this.map.setCursorRow(0)),console.log(n,this.point),this.map.turnOnDotAtCursor(),this.time=e,!1},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var XYGBoy;!function(t){var e=function(t){function e(e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),t.call(this,e,i,n)}__extends(e,t);var i=(__define,e);i.prototype;return e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right",e.A="a",e.B="b",e}(egret.Event);t.ControllerEvent=e,egret.registerClass(e,"XYGBoy.ControllerEvent")}(XYGBoy||(XYGBoy={}));var XYGBoy;!function(t){var e=function(t){function e(e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),t.call(this,e,i,n)}__extends(e,t);var i=(__define,e);i.prototype;return e.GAMEOVER="game_over",e.WIN="win",e}(egret.Event);t.GameSceneEvent=e,egret.registerClass(e,"XYGBoy.GameSceneEvent")}(XYGBoy||(XYGBoy={}));var XYGBoy;!function(t){var e=function(t){function e(e,n){void 0===n&&(n=i.OFF),t.call(this),this.flickerDelay=250,this.status=n,this.width=e,this.height=e,this.size=e,this.renderTexture()}__extends(e,t);var o=(__define,e),s=o.prototype;return s.getStatus=function(){return this.status},s.setStatus=function(t){this.status=t,this.renderTexture()},s.turnOn=function(){this.stopFlicker(),this.setStatus(i.ON)},s.flicker=function(t){void 0===t&&(t=250),this.setStatus(i.FLICKER),this.timer=new egret.Timer(t,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.doFlicker,this),this.timer.start()},s.doFlicker=function(){this.texture==n.getInstance().TEXTURE_ON?this.texture=n.getInstance().TEXTURE_OFF:this.texture=n.getInstance().TEXTURE_ON},s.stopFlicker=function(){this.timer&&this.timer.stop()},s.turnOff=function(){this.stopFlicker(),this.setStatus(i.OFF)},s.renderTexture=function(){switch(this.status){case i.ON:this.texture=n.getInstance().TEXTURE_ON;break;case i.OFF:default:this.texture=n.getInstance().TEXTURE_OFF,this.timer=null;break;case i.FLICKER:}},s.setPosition=function(t,e,i){this.x=e*i,this.y=t*i},s.clone=function(){return new e(this.size,this.status)},e}(egret.Bitmap);t.Dot=e,egret.registerClass(e,"XYGBoy.Dot"),function(t){t[t.OFF=0]="OFF",t[t.FLICKER=1]="FLICKER",t[t.ON=2]="ON"}(t.DotStatus||(t.DotStatus={}));var i=t.DotStatus,n=function(){function t(){this.TEXTURE_ON=RES.getRes("on_png"),this.TEXTURE_OFF=RES.getRes("off_png")}var e=(__define,t);e.prototype;return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t}();egret.registerClass(n,"DotTextures")}(XYGBoy||(XYGBoy={}));var XYGBoy;!function(t){var e=function(e){function n(t,i,n){e.call(this),this.row=t,this.column=i,this.dotSize=n,this.width=i*n,this.height=t*n,this.initDotMap(t,i),this.cursor=this.getCursor()}__extends(n,e);var o=(__define,n),s=o.prototype;return s.initDotMap=function(e,i,n){void 0===n&&(n=null),this.dotMap=new Array;for(var o=0;e>o;o++){this.dotMap[o]=new Array;for(var s=0;i>s;s++){var r=null==n?new t.Dot(this.dotSize,t.DotStatus.OFF):n.clone();r.setPosition(o,s,this.dotSize),this.dotMap[o][s]=r,this.addChild(r)}}},s.resize=function(){return!0},s.getRow=function(){return this.row},s.getColumn=function(){return this.column},s.getCursor=function(){return null==this.cursor&&(this.cursor=new i),this.cursor},s.getCursorRow=function(){return this.cursor.row},s.getCursorColumn=function(){return this.cursor.column},s.setCursorByPointer=function(t){return this.setCursor(t.row,t.column)},s.setCursor=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>=this.row&&(t=this.row-1),0>t&&(t=0),e>=this.column&&(e=this.column-1),0>e&&(e=0),this.cursor.row=t,this.cursor.column=e,!0},s.setCursorRow=function(t){void 0===t&&(t=0),this.cursor.row=t},s.setCursorColumn=function(t){void 0===t&&(t=0),this.cursor.column=t},s.getDotAtCursor=function(){return this.getDotAt(this.cursor.row,this.cursor.column)},s.getDotAt=function(t,e){return this.dotMap[t][e]},s.turnOnDotAtCursor=function(){this.turnOnDotAt(this.cursor.row,this.cursor.column)},s.turnOnDotAt=function(t,e){this.getDotAt(t,e).turnOn()},s.turnOnDotAtGroup=function(t){for(var e in t.points)this.turnOnDotAtPointer(t.getAt(e))},s.turnOnDotAtPointer=function(t){this.setCursorByPointer(t),this.turnOnDotAtCursor()},s.turnOffDotAtCursor=function(){this.turnOffDotAt(this.cursor.row,this.cursor.column)},s.turnOffDotAtGroup=function(t){for(var e in t.points)this.turnOffDotAtPointer(t.getAt(e))},s.turnOffDotAtPointer=function(t){this.setCursorByPointer(t),this.turnOffDotAtCursor()},s.turnOffDotAt=function(t,e){this.getDotAt(t,e).turnOff()},s.turnOffAllDot=function(){for(var t in this.dotMap)for(var e in this.dotMap[t])this.dotMap[t][e].turnOff()},s.flickerDotAtPointer=function(t){this.setCursorByPointer(t),this.flickerDotAtCursor()},s.flickerDotAtCursor=function(){this.getDotAtCursor().flicker()},n}(egret.DisplayObjectContainer);t.DotMap=e,egret.registerClass(e,"XYGBoy.DotMap");var i=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.row=t,this.column=e}var e=(__define,t),i=e.prototype;return i.equals=function(t){return t&&this.row==t.row&&this.column==t.column},i.clone=function(){return new t(this.row,this.column)},i.set=function(t){this.row=t.row,this.column=t.column},t}();t.DotMapPointer=i,egret.registerClass(i,"XYGBoy.DotMapPointer");var n=function(){function t(){this.points=new Array}var e=(__define,t),i=e.prototype;return i.getAt=function(t){return this.points[t]},i.setAt=function(t,e){this.points[e]=t},i.first=function(){return this.points[0]},i.last=function(){return this.points[this.points.length-1]},i.size=function(){return this.points.length},t}();t.DotMapPointerGroup=n,egret.registerClass(n,"XYGBoy.DotMapPointerGroup");var o=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.row=t,this.column=e}var e=(__define,t),i=e.prototype;return i.getStatus=function(){return this.status},i.stop=function(){this.row=0,this.column=0,this.status=s.STAND},i.up=function(){this.row=-1,this.column=0,this.status=s.UP},i.down=function(){this.row=1,this.column=0,this.status=s.DOWN},i.left=function(){this.row=0,this.column=-1,this.status=s.LEFT},i.right=function(){this.row=0,this.column=1,this.status=s.RIGHT},t}();t.DotMapDirector=o,egret.registerClass(o,"XYGBoy.DotMapDirector"),function(t){t[t.STAND=0]="STAND",t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT"}(t.DotMapDirection||(t.DotMapDirection={}));var s=t.DotMapDirection}(XYGBoy||(XYGBoy={}));var XYGBoy;!function(t){var e=function(e){function i(t,i,n){e.call(this),this.width=i,this.height=n,this.gameMap=t,this.initBtn()}__extends(i,e);var n=(__define,i),o=n.prototype;return o.initBtn=function(){this.initBtnA(),this.initBtnB(),this.initBtnUp(),this.initBtnDown(),this.initBtnLeft(),this.initBtnRight()},o.initBtnA=function(){this.btnA=new t.DotMap(3,3,25),this.btnA.x=600,this.btnA.y=200,this.btnA.touchEnabled=!0,this.addChild(this.btnA),this.btnA.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapBtnA,this)},o.tapBtnA=function(e){this.gameMap.dispatchEvent(new t.ControllerEvent(t.ControllerEvent.A))},o.initBtnB=function(){this.btnB=new t.DotMap(4,3,25),this.btnB.x=600,this.btnB.y=400,this.btnB.touchEnabled=!0,this.addChild(this.btnB),this.btnB.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapBtnB,this)},o.tapBtnB=function(e){var i=new t.ControllerEvent(t.ControllerEvent.B);this.gameMap.dispatchEvent(i)},o.initBtnUp=function(){this.btnUp=new t.DotMap(4,3,25),this.btnUp.x=100,this.btnUp.y=100,this.btnUp.touchEnabled=!0,this.addChild(this.btnUp),this.btnUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapBtnUp,this)},o.tapBtnUp=function(){this.gameMap.dispatchEvent(new t.ControllerEvent(t.ControllerEvent.UP))},o.initBtnDown=function(){this.btnDown=new t.DotMap(4,3,25),this.btnDown.x=100,this.btnDown.y=400,this.btnDown.touchEnabled=!0,this.addChild(this.btnDown),this.btnDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapBtnDown,this)},o.tapBtnDown=function(){this.gameMap.dispatchEvent(new t.ControllerEvent(t.ControllerEvent.DOWN))},o.initBtnLeft=function(){this.btnLeft=new t.DotMap(4,3,25),this.btnLeft.x=50,this.btnLeft.y=250,this.btnLeft.touchEnabled=!0,this.addChild(this.btnLeft),this.btnLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapBtnLeft,this)},o.tapBtnLeft=function(){this.gameMap.dispatchEvent(new t.ControllerEvent(t.ControllerEvent.LEFT))},o.initBtnRight=function(){this.btnRight=new t.DotMap(4,3,25),this.btnRight.x=150,this.btnRight.y=250,this.btnRight.touchEnabled=!0,this.addChild(this.btnRight),this.btnRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapBtnRight,this)},o.tapBtnRight=function(){this.gameMap.dispatchEvent(new t.ControllerEvent(t.ControllerEvent.RIGHT))},i}(egret.DisplayObjectContainer);t.DotControllerPanel=e,egret.registerClass(e,"XYGBoy.DotControllerPanel")}(XYGBoy||(XYGBoy={}));var XYGBoy;!function(t){var e=function(e){function i(i,n,o){e.call(this),this.speed=1,this.delay=1e3,this.width=n*o,this.height=i*o,this.map=new t.DotMap(i,n,o),this.body=new t.DotMapPointerGroup,this.body.points.push(new t.DotMapPointer(i/2,n/2)),this.addChild(this.map),this.speed=2,this.direction=new t.DotMapDirector,egret.startTick(this.draw,this),this.initControllerEvent(),this.timer=new egret.Timer(this.delay/this.speed,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.gameTimer,this),this.timer.start(),this.feed(),this.map.turnOnDotAtGroup(this.body)}__extends(i,e);var n=(__define,i),o=n.prototype;return o.draw=function(t){return!0},o.gameTimer=function(){this.canEat()&&(this.eat(),this.growUp(this.food),this.feed()),this.move(),this.isOver()&&this.gameover()},o.feed=function(){var t=this.map.getRow()*this.map.getColumn(),e=this.body.points.length,i=t-e,n=Math.floor(Math.random()*i);this.food=this.feedingPoint2MapPointer(n),this.map.flickerDotAtPointer(this.food)},o.feedingPoint2MapPointer=function(e){for(var i=0,n=0;n<this.map.getRow();n++)for(var o=0;o<this.map.getColumn();o++)if(this.map.getDotAt(n,o).getStatus()==t.DotStatus.OFF&&(i++,i==e))return new t.DotMapPointer(n,o);return null},o.canEat=function(){return this.body.first().equals(this.food)},o.eat=function(){this.map.turnOnDotAtPointer(this.food)},o.growUp=function(t){this.body.points.push(t)},o.move=function(){this.map.turnOffDotAtPointer(this.body.last());for(var t=this.body.size()-1;t>0;t--){var e=this.body.getAt(t),i=this.body.getAt(t-1);e.set(i)}this.body.first().row+=this.direction.row,this.body.first().column+=this.direction.column,this.map.turnOnDotAtGroup(this.body)},o.isOver=function(){for(var t=1;t<this.body.size();t++)if(this.body.getAt(t).equals(this.body.first()))return!0;return this.body.first().row>=this.map.getRow()||this.body.first().row<0||this.body.first().column>=this.map.getColumn()||this.body.first().column<0?!0:!1},o.gameover=function(){this.timer.stop(),this.gameScene.dispatchEvent(new t.GameSceneEvent(t.GameSceneEvent.GAMEOVER))},o.initControllerEvent=function(){this.addEventListener(t.ControllerEvent.A,this.tapBtnA,this),this.addEventListener(t.ControllerEvent.B,this.tapBtnB,this),this.addEventListener(t.ControllerEvent.UP,this.tapBtnUp,this),this.addEventListener(t.ControllerEvent.DOWN,this.tapBtnDown,this),this.addEventListener(t.ControllerEvent.LEFT,this.tapBtnLeft,this),this.addEventListener(t.ControllerEvent.RIGHT,this.tapBtnRight,this)},o.tapBtnA=function(){this.speedUp()},o.tapBtnB=function(){this.speedDown()},o.tapBtnUp=function(){this.direction.getStatus()!=t.DotMapDirection.DOWN&&this.direction.up()},o.tapBtnDown=function(){this.direction.getStatus()!=t.DotMapDirection.UP&&this.direction.down()},o.tapBtnLeft=function(){this.direction.getStatus()!=t.DotMapDirection.RIGHT&&this.direction.left()},o.tapBtnRight=function(){this.direction.getStatus()!=t.DotMapDirection.LEFT&&this.direction.right()},o.speedUp=function(){this.speed++,this.timer.delay=this.delay/this.speed},o.speedDown=function(){this.speed>1&&this.speed--,this.timer.delay=this.delay/this.speed},i}(egret.DisplayObjectContainer);t.DotSnakePanel=e,egret.registerClass(e,"XYGBoy.DotSnakePanel")}(XYGBoy||(XYGBoy={}));var XYGBoy;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.row=t,this.col=e}var e=(__define,t);e.prototype;return t}();t.MatrixPointer=e,egret.registerClass(e,"XYGBoy.MatrixPointer")}(XYGBoy||(XYGBoy={}));var XYGBoy;!function(t){var e=function(e){function i(t,i){e.call(this),this.dotSize=25,this.width=t,this.height=i,this.snake()}__extends(i,e);var n=(__define,i),o=n.prototype;return o.showGameOver=function(){alert("game over"),this.snake()},o.snake=function(){this.gamePanel=new t.DotSnakePanel(20,10,this.dotSize),this.gamePanel.gameScene=this,this.addEventListener(t.GameSceneEvent.GAMEOVER,this.showGameOver,this),this.gamePanel.x=(this.width-this.gamePanel.width)/2,this.addChildAt(this.gamePanel,10),this.gameController=new t.DotControllerPanel(this.gamePanel,this.width,this.height),this.addChild(this.gameController)},i}(egret.DisplayObjectContainer);t.GameScene=e,egret.registerClass(e,"XYGBoy.GameScene")}(XYGBoy||(XYGBoy={}));